<#
.SYNOPSIS
    Installs the application: ${appName}
    Version: ${version}
    Publisher: ${publisher}
.DESCRIPTION
    This script is automatically generated by the Intune Package Utility.
#>
$ErrorActionPreference = "Stop"

try {
    Write-Host "Starting installation for ${appName}"
    
    # Pre-install custom script entries
#if( $preInstallScript && $preInstallScript != "" )
    Write-Host "Executing pre-install script entries..."
    $preInstallScript
#end
    
    # Define the command from the template binding
    $installCommand = '${installCmd}'
    
    Write-Host "Executing: $installCommand"

    # Depending on MSI or EXE, execute the command
    # Using Start-Process to ensure it blocks and waits
    if ("${sourceType}" -eq "MSI") {
        # Split msiexec arguments appropriately
        $proc = Start-Process -FilePath "msiexec.exe" -ArgumentList "/i `"${sourceFileName}`" /qn" -Wait -PassThru
        if ($proc.ExitCode -ne 0 -and $proc.ExitCode -ne 3010) {
            throw "Installation failed with exit code $($proc.ExitCode)"
        }
    } else {
        # Generic EXE
        $proc = Start-Process -FilePath ".\${sourceFileName}" -ArgumentList '${installCmdArgs}' -Wait -PassThru
        if ($proc.ExitCode -ne 0 -and $proc.ExitCode -ne 3010) {
            throw "Installation failed with exit code $($proc.ExitCode)"
        }
    }

    Write-Host "Installation completed successfully."
    exit 0
} catch {
    Write-Error $_.Exception.Message
    exit 1
}
