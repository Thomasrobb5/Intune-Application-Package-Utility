<#
.SYNOPSIS
    Uninstalls the application: ${appName}
    Version: ${version}
    Publisher: ${publisher}
.DESCRIPTION
    This script is automatically generated by the Intune Package Utility.
#>
$ErrorActionPreference = "Stop"

try {
    Write-Host "Starting uninstallation for ${appName}"
    
    # Define the command from the template binding
    $uninstallCommand = '${uninstallCmd}'
    
    Write-Host "Executing: $uninstallCommand"

    if ("${sourceType}" -eq "MSI") {
        # Split msiexec arguments appropriately
        $proc = Start-Process -FilePath "msiexec.exe" -ArgumentList "/x `"${detectionRule}`" /qn" -Wait -PassThru
        if ($proc.ExitCode -ne 0 -and $proc.ExitCode -ne 3010 -and $proc.ExitCode -ne 1605) {
            # 1605 = this action is only valid for products that are currently installed (already uninstalled)
            throw "Uninstallation failed with exit code $($proc.ExitCode)"
        }
    } else {
        # Generic EXE
        $proc = Start-Process -FilePath ".\${sourceFileName}" -ArgumentList '${uninstallCmdArgs}' -Wait -PassThru
        if ($proc.ExitCode -ne 0 -and $proc.ExitCode -ne 3010) {
            throw "Uninstallation failed with exit code $($proc.ExitCode)"
        }
    }

    Write-Host "Uninstallation completed successfully."
    exit 0
} catch {
    Write-Error $_.Exception.Message
    exit 1
}
